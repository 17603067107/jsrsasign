<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="HTTPS設定ファイル生成ツール" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
    <title>HTTPS設定ファイル生成ツール(ベータ版)</title>
<!-- for pkcs5pkey -->
<script language="JavaScript" type="text/javascript" src="jsrsasign-latest-all-min.js"></script>
<script language="JavaScript" type="text/javascript">
var OPENSSL_CIPHERSUITE = {
  "cryptrec1": "ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-GCM-SHA256",
  "cryptrec2": "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-CAMELLIA128-SHA:DHE-RSA-AES128-SHA:AES128-GCM-SHA256:AES128-SHA256:CAMELLIA128-SHA:AES128-SHA:ECDH-ECDSA-AES128-GCM-SHA256:ECDH-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-SHA256:DHE-RSA-CAMELLIA256-SHA:DHE-RSA-AES256-SHA:AES256-GCM-SHA384:AES256-SHA256:CAMELLIA256-SHA:AES256-SHA:ECDH-ECDSA-AES256-GCM-SHA384:ECDH-RSA-AES256-GCM-SHA384",
  "cryptrec3": "DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-CAMELLIA128-SHA:DHE-RSA-AES128-SHA:AES128-GCM-SHA256:AES128-SHA256:CAMELLIA128-SHA:AES128-SHA:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-SHA256:DHE-RSA-CAMELLIA256-SHA:DHE-RSA-AES256-SHA:AES256-GCM-SHA384:AES256-SHA256:CAMELLIA256-SHA:AES256-SHA:RC4-SHA:EDH-RSA-DES-CBC3-SHA:DES-CBC3-SHA",
  "mozilla1": "ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!3DES:!MD5:!PSK",
  "mozilla2": "ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA",
  "mozilla3": "ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:ECDHE-RSA-DES-CBC3-SHA:ECDHE-ECDSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA",
  "ivanpfsblog": "EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS",
  "openssl_default": "DEFAULT",
  "redhat_default": "HIGH:!aNULL:!MD5:!RC4",
  "centos6_default": "ALL:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM:+LOW",
  "ubuntu12_default": "HIGH:MEDIUM:!aNULL:!MD5",
  "general_default": "ALL:!aNULL:!eNULL:!LOW:!EXP:RC4+RSA:+HIGH:+MEDIUM",
};

var CFG_TEMPLATE = {
// **** テンプレート始まり ***********************
"apache24": 
(function() {/*
# sample ssl.conf for Apache 2.4
Listen 443 https
SSLPassPhraseDialog exec:/usr/libexec/httpd-ssl-pass-dialog
SSLSessionCache         shmcb:/run/httpd/sslcache(512000)
SSLSessionCacheTimeout  300
SSLRandomSeed startup file:/dev/urandom  256
SSLRandomSeed connect builtin
SSLCryptoDevice builtin

<VirtualHost _default_:443>
ErrorLog logs/ssl_error_log
TranferLog logs/ssl_access_log
LogLevel warn
SSLEngine on
SSLProtocol %%%PROTOCOL%%%
SSLCipherSuite %%%CIPHERSUITE%%%
%%%CIPHERORDER%%%
SSLCertificateFile conf/ssl/server.crt
SSLCertificateKeyFile conf/ssl/server.key
%%%KEYPINNING%%%
<Files ~ "\.(cgi|shtml|phtml|php3?)$">
    SSLOptions +StdEnvVars
</Files>
BrowserMatch "MSIE [2-5]" \
         nokeepalive ssl-unclean-shutdown \
         downgrade-1.0 force-response-1.0
</VirtualHost>
*/}).toString().match(/\/\*([^]*)\*\//)[1],
// **** テンプレートおわり ***********************
// **** テンプレート始まり ***********************
"apache22": 
(function() {/*
# sample ssl.conf for Apache 2.2
LoadModule ssl_module modules/mod_ssl.so
Listen 443
SSLPassPhraseDialog  builtin
SSLSessionCache         shmcb:/var/cache/mod_ssl/scache(512000)
SSLSessionCacheTimeout  300
SSLMutex default
SSLRandomSeed startup file:/dev/urandom  256
SSLRandomSeed connect builtin
SSLCryptoDevice builtin

<VirtualHost _default_:443>
ErrorLog logs/ssl_error_log
TranferLog logs/ssl_access_log
LogLevel warn
SSLEngine on
SSLProtocol %%%PROTOCOL%%%
SSLCipherSuite %%%CIPHERSUITE%%%
%%%CIPHERORDER%%%
SSLCertificateFile conf/ssl/server.crt
SSLCertificateKeyFile conf/ssl/server.key
SSLCertificateChainFile conf/ssl/chain.crt
%%%KEYPINNING%%%
<Files ~ "\.(cgi|shtml|phtml|php3?)$">
    SSLOptions +StdEnvVars
</Files>
SetEnvIf User-Agent ".*MSIE.*" \
         nokeepalive ssl-unclean-shutdown \
         downgrade-1.0 force-response-1.0
</VirtualHost>
*/}).toString().match(/\/\*([^]*)\*\//)[1],
// **** テンプレートおわり ***********************
};

function doGen() {
  var f1 = document.form1;

  var sCertPEM = f1.cert1.value;

  //alert(1);
  var cfg = CFG_TEMPLATE[f1.serverapp.value];
  cfg = cfg.replace("%%%PROTOCOL%%%", _getProtocolValue(f1.guidename.value, f1.serverapp.value));
  cfg = cfg.replace("%%%CIPHERSUITE%%%", OPENSSL_CIPHERSUITE[f1.guidename.value]);

  if (f1.guidename.value.indexOf("cryptrec") != -1 ||
      f1.guidename.value.indexOf("mozilla") != -1) {
    cfg = cfg.replace("%%%CIPHERORDER%%%", "SSLHonorCipherOrder On");
  } else {
    cfg = cfg.replace("%%%CIPHERORDER%%%", "#SSLHonorCipherOrder On");
  }

  cfg = _setPinning(cfg, f1);

  f1.resultcfg.value = cfg;
}

function _setPinning(cfg, f1) {
  var a = _getCertPinArray(f1);
  if (a.length != 0) {
    var s = "Header always set Public-Key-Pins \"";
    for (var i = 0; i < a.length; i++) {
      s += "pin-sha256=\\\"" + a[i] + "\\\"; ";
    }
    s += "\"";
    cfg = cfg.replace("%%%KEYPINNING%%%", s);
  } else {
    cfg = cfg.replace("%%%KEYPINNING%%%", "");
  }
  return cfg;
}

function _getCertPinArray(f1) {
  var a = new Array();
  var c1 = f1.cert1.value;
  var c2 = f1.cert2.value;
  var c3 = f1.cert3.value;
  if (c1 != "") a.push(_getSHA256HashB64OfCertPEM(c1));
  if (c2 != "") a.push(_getSHA256HashB64OfCertPEM(c2));
  if (c3 != "") a.push(_getSHA256HashB64OfCertPEM(c3));
  return a;
}

function _getSHA256HashB64OfCertPEM(sCertPEM) {
  var keyhex = _getPublicKeyInfoHexOfCertPEM(sCertPEM);
  var hashhex = KJUR.crypto.Util.hashHex(keyhex, "sha256");
  var hashb64 = hextob64(hashhex);
  return hashb64;
}

function _getPublicKeyInfoHexOfCertPEM(sCertPEM) {
    var result = {};
    result.algparam = null;
    var hCert = X509.pemToHex(sCertPEM);

    // 1. Certificate ASN.1
    var a1 = ASN1HEX.getPosArrayOfChildren_AtObj(hCert, 0); 
    if (a1.length != 3)
        throw "malformed X.509 certificate PEM (code:001)"; // not 3 item of seq Cert

    // 2. tbsCertificate
    if (hCert.substr(a1[0], 2) != "30")
        throw "malformed X.509 certificate PEM (code:002)"; // tbsCert not seq 

    var a2 = ASN1HEX.getPosArrayOfChildren_AtObj(hCert, a1[0]); 

    // 3. subjectPublicKeyInfo
    if (a2.length < 7)
        throw "malformed X.509 certificate PEM (code:003)"; // no subjPubKeyInfo

    var publicKeyInfoHex = ASN1HEX.getHexOfTLV_AtObj(hCert, a2[6]);
    return publicKeyInfoHex;
};

function _getProtocolValue(guideName, serverType) {
  if (serverType == "apache24" || serverType == "apache22") {
    if (guideName == "cryptrec1") return "TLSv1.2";
    if (guideName == "cryptrec2") return "all -SSLv2 -SSLv3";
    if (guideName == "cryptrec3") return "all -SSLv2";
    if (guideName == "mozilla1") return "all -SSLv3 -TLSv1";
    if (guideName == "mozilla2") return "all -SSLv3";
    if (guideName == "mozilla3") return "all";
    if (guideName == "ivanpfsblog") return "all -SSLv2 -SSLv3";
    return "all"; // デフォルト
  }
  return "---NOT SUPPORTED---";
}
</script>
</head>

<body>

<!-- HEADER -->
<div id="header_wrap" class="outer">
<header class="inner">
<h1 id="project_title">HTTPS設定ファイル生成ツール(ベータ版)</h1>
<h2 id="project_tagline">各種ガイドラインに応じたApacheやnginxなど主要なサーバーのHTTPS設定を自動生成します</h2>

<a href="http://kjur.github.io/jsrsasign/">TOP</a> | 
</header>
</div>

<!-- MAIN CONTENT -->
<div id="main_content_wrap" class="outer">
<section id="main_content" class="inner">

<!-- now editing -->
<form name="form1">

<!-- ******************************* -->
<h4>簡易設定情報</h4>
<p>
ガイドラインの種類：
<select name="guidename">
<option value="cryptrec1">CRYPTREC/IPAガイド(2015.05版)高セキュリティ型 - 高いセキュリティを求める医療・金融、政府機関等向け
<option value="cryptrec2">CRYPTREC/IPAガイド(2015.05版)推奨セキュリティ型 - 標準的な設定
<option value="cryptrec3">CRYPTREC/IPAガイド(2015.05版)セキュリティ例外型 - 古いフィーチャーフォン、ゲーム機も対象に含む場合
<option value="mozilla1">Mozilla Modern Compatibility Profile - 高セキュリティ
<option value="mozilla2">Mozilla Intermediate Compatibility Profile - 中セキュリティ(デフォルト)
<option value="mozilla3">Mozilla Old Backward Compatibility Profile - 低セキュリティ
<option value="ivanpfsblog">Ivan Ristic氏のPFSに関するブログでの推奨設定

<option value="openssl_default">OpenSSLデフォルト設定
<option value="redhat_default">RedHat Linuxデフォルト設定
<option value="centos6_default">CentOS 6デフォルト設定
<option value="ubuntu12_default">Ubuntu 12デフォルト設定
<option value="general_default">よくあるデフォルト設定
</select>
</p>
<p>
サーバーソフトウェアの種類：
<select name="serverapp">
<option value="apache24">Apache HTTP Server 2.4
<option value="apache22">Apache HTTP Server 2.2
</select>
</p>
<p>
SSLサーバー証明書PEM<br/>
<textarea name="cert1" cols="80" rows="3"></textarea>
<br/>中間CA証明書1(SSLサーバーに近い順)<br/>
<textarea name="cert2" cols="80" rows="3"></textarea>
<br/>中間CA証明書2(SSLサーバーに近い順、ルートに近いもの)<br/>
<textarea name="cert3" cols="80" rows="3"></textarea>
<br/>

</p>
<p>
<input type="button" value="生成" onClick="doGen();"/>
<input type="reset" name="reset" value="Reset"/>
</p>

<h4>生成された設定ファイルの一部</h4>
<textarea name="resultcfg" cols="100" rows="40">
</textarea>

<h4>本ツールの説明</h4>
<p>
<a href="http://www.ipa.go.jp/security/vuln/ssl_crypt_config.html" target="_blank">
「CRYPTREC/IPA SSL/TLS暗号設定ガイドライン～安全なウェブサイトのために（暗号設定対策編）～」</a>
の発行を記念しまして、ウェブサーバーのSSL設定ファイルを生成するツールのベータ版を公開します。
本ツールは、CRYPTOREC/IPAのガイドラインで定義されている「高セキュリティ型」
「推奨セキュリティ型」「セキュリティ例外型」の設定に加え、Mozillaや他のプロファイルの
推奨設定もメニューで選ぶだけで簡単に生成できます。
</p>
<p>
現時点ではベータ版のため、
<ul>
<li>Apache 2.4系、Apache 2.2系のssl.conf設定ファイルしか生成できない。(nginx等近日対応)</li>
<li>暗号スイート、プロトコル、暗号スイート順序、Public Key Pinningしか設定されない。</li>
<li>OCSP stapling、HSTSなどは未対応。(近日対応予定)</li>
</ul>
となっていますが、よかったらご利用ください。Public Key Pinningの設定に対応するためは、
SSLサーバー証明書、中間CA証明書のPEM形式でコピーペーストして頂ければ、自動的にPinningの
設定を出力します。
</p>
<p>
本ツールは、<a href="https://twitter.com/kjur">@kjur</a> が個人的に作成したものであり、CRYPTRECやIPAとは無関係です。バグ報告や問題のご指摘は<a href="https://github.com/kjur/jsrsasign/issues">こちらのバグトラッカー</a>で日本語でお知らせください。
</p>

<hr/>
<h4>参考リンク</h4>
<ul>
<li><a href="http://www.ipa.go.jp/security/vuln/ssl_crypt_config.html" target="_blank">
CRYPTREC/IPA SSL/TLS暗号設定ガイドライン～安全なウェブサイトのために（暗号設定対策編）～</a></li>
<li><a href="https://wiki.mozilla.org/Security/Server_Side_TLS">
Mozilla Wiki: Security/Server Side TLS</a></li>
<li><a href="https://mozilla.github.io/server-side-tls/ssl-config-generator/">
Mozilla SSL Configuration Generator</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Public_Key_Pinning">
Mozilla Developper Network: Public Key Pinning</a></li>
</ul>

</form>

<!-- now editing -->

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">jsrsasign maintained by <a href="https://github.com/kjur">kjur</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
<div align="center" style="color: white">
Copyright &copy; 2015 Kenji Urushima. All rights reserved.
</div>
      </footer>
    </div>

  </body>
</html>
